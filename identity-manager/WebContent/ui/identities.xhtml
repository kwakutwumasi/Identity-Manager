<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ga="http://gravel.jboss.org/jsf/2.0/action"
    xmlns:n="http://gravel.jboss.org/jsf/2.0/navigation"
    xmlns:com="http://quakearts.com/2.0/common"
    xmlns:b="http://quakearts.com/2.0/boot">
    
<ui:composition template="../ua/t_base_bare.xhtml">
	<ui:define name="header">
	    <ga:responseActions>
	        <ga:parameter name="username" target="#{search.username}" />
	        <ga:parameter name="roles" target="#{search.roles}" />
	        <ga:parameter name="status" target="#{search.status}" />
	    </ga:responseActions> 
	</ui:define>
	<ui:define name="body">
		<h:form>
			<b:panel>
				<f:facet name="header">Users</f:facet>
				<span class="h5">Filter results by</span>
			
				<b:inputText label="Username" value="#{search.username}" id="u" />
				<b:selectOneInputGroup label="Status" value="#{search.status}">
	               	<f:selectItem itemValue="" itemLabel="Select one..." />
	               	<f:selectItem itemValue="valid" itemLabel="Active" />
	               	<f:selectItem itemValue="invalid" itemLabel="Inactive" />
	               	<f:selectItem itemValue="both" itemLabel="All" />
				</b:selectOneInputGroup>
	
			 	<b:inputText label="Role" value="#{search.roles}"></b:inputText>
			 	<b:button value="Search">
			 		<f:ajax render="@form" execute="@form" onevent="#{loader.mainAjaxLoader}"></f:ajax>
			 		<com:executeAction listener="#{search.clear}"></com:executeAction>
			 	</b:button>
				
				<b:pagination for="#{table}"></b:pagination>
				<b:dataTable value="#{search.users}" var="u" idVar="rid" binding="#{table}">
					<h:column>
						<f:facet name="header"><h:outputText value="UserName" /></f:facet>
						<h:outputText value="#{u.username}" />
					</h:column>
					<h:column>
						<f:facet name="header"><h:outputText value="Full Name" /></f:facet>
						<h:outputText value="#{u.name}"/>
					</h:column>
					<h:column>
						<f:facet name="header"><h:outputText value="Roles" /></f:facet>
						<ui:repeat value="#{u.rolesList}" var="role"><h:outputText value="#{role.roleName};" rendered="#{role.valid}"/></ui:repeat>
					</h:column>
					<h:column>
						<f:facet name="header"><h:outputText value="Active" /></f:facet>
						<h:outputText value="#{u.valid}" />
					</h:column>
					<h:column>
						<b:menu value="Action">
							<li>
								<h:commandLink value="#{u.valid?'Deactivate':'Activate'}">
									<f:ajax onevent="#{loader.miniAjaxLoader}"></f:ajax>
									<com:set var="#{userManagement.user}" as="#{u}"></com:set>
									<com:set var="#{userManagement.user.valid}" as="#{!userManagement.user.valid}" />
									<com:executeAction listener="#{userManagement.updateUser}"></com:executeAction>
								</h:commandLink>
							</li>
							<h:outputLink value="modify.jsf">Modify User
								<f:param name="id" value="#{u.id}"></f:param>
							</h:outputLink>
						</b:menu>
				    </h:column>
				</b:dataTable>
			</b:panel>
		</h:form>
	</ui:define>
</ui:composition>
</html>